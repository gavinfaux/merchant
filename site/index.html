<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>merchant — sell anything, anywhere</title>
  <link rel="icon" type="image/svg+xml" href="/site/logomark.svg">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/muuri@0.9.5/dist/muuri.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:ital,wght@0,400;0,500;0,600;1,400&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            serif: ['Instrument Serif', 'serif'],
            sans: ['DM Sans', 'sans-serif'],
            mono: ['IBM Plex Mono', 'monospace'],
          },
          colors: {
            wheat: {
              50: '#fdfcf9',
              100: '#faf8f3',
              200: '#f5f2eb',
              300: '#f0ece3',
              400: '#ebe6db',
              500: '#d4cdc0',
            },
            ink: {
              DEFAULT: '#1c1917',
              secondary: '#57534e',
              muted: '#a8a29e',
            }
          }
        },
      },
    }
  </script>
  <style>
    html, body {
      height: 100%;
      overflow: hidden;
    }
    
    .grid-container {
      position: relative;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .grid-container.ready {
      opacity: 1;
    }
    
    .item {
      position: absolute;
      z-index: 1;
      padding: 4px;
    }
    
    @media (min-width: 640px) {
      .item {
        padding: 6px;
      }
    }
    
    .item.muuri-item-dragging {
      z-index: 3;
    }
    
    .item.muuri-item-releasing {
      z-index: 2;
    }
    
    .item.muuri-item-hidden {
      z-index: 0;
    }
    
    .item-content {
      position: relative;
      width: 100%;
      height: 100%;
      cursor: grab;
      box-sizing: border-box;
    }
    
    .item-content:active {
      cursor: grabbing;
    }
    
    .muuri-item-dragging .item-content {
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      transform: scale(1.02);
    }
    
    #product-emoji {
      transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.2s ease;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .animate-pulse {
      animation: pulse 1s ease-in-out infinite;
    }
  </style>
</head>
<body class="h-screen w-screen bg-wheat-100 p-2 sm:p-3 font-sans">
  
  <div id="grid" class="grid-container h-full w-full">
    
    <!-- Hero block -->
    <div class="item item-hero">
      <div class="item-content bg-white rounded-3xl ring-1 ring-wheat-400 shadow-sm flex flex-col justify-center items-start px-6 py-8 sm:px-10 sm:py-10 lg:px-16 lg:py-12">
        <svg class="h-4 sm:h-5 lg:h-6 w-auto mb-4 sm:mb-5 lg:mb-6 flex-shrink-0" style="color: var(--ink-muted, #a8a29e)" viewBox="0 0 340 88" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M298 84V88H42V84H298ZM336 46V42C336 21.0132 318.987 4 298 4H42C21.0132 4 4 21.0132 4 42V46C4 66.9868 21.0132 84 42 84V88C18.804 88 0 69.196 0 46V42C1.03095e-06 18.804 18.804 1.61065e-08 42 0H298L299.084 0.0136719C321.779 0.588628 340 19.1665 340 42V46L339.986 47.084C339.421 69.4187 321.419 87.4205 299.084 87.9863L298 88V84C318.987 84 336 66.9868 336 46Z"/>
          <path d="M296.038 37.4H286.438V56.6H296.038V63H289.638C283.238 63 280.038 59.8 280.038 53.4V37.4H273.638V31H280.038V18.2H286.438V31H296.038V37.4Z"/>
          <path d="M259.237 31C265.637 31 270.438 35.8 270.438 43.8V63H264.038V47C264.038 40.6 260.838 37.4 256.038 37.4C251.238 37.4 248.038 40.6 248.038 47V63H241.637V31H248.038V43.8C248.038 35.8 252.837 31 259.237 31Z"/>
          <path d="M228.85 31H235.25V63H228.85V50.2C228.85 58.2 225.65 63 219.25 63C211.25 63 204.85 56.6 204.85 47C204.85 37.4 211.25 31 219.25 31C225.65 31 228.85 35.8 228.85 43.8V31ZM220.85 56.6C225.65 56.6 228.85 53.4 228.85 47C228.85 40.6 225.65 37.4 220.85 37.4C216.05 37.4 211.25 40.6 211.25 47C211.25 53.4 216.05 56.6 220.85 56.6Z"/>
          <path d="M188.863 31C195.263 31 200.062 35.8 200.062 43.8V63H193.663V47C193.663 40.6 190.463 37.4 185.663 37.4C180.863 37.4 177.663 40.6 177.663 47V63H171.262V18.2H177.663V43.8C177.663 35.8 182.463 31 188.863 31Z"/>
          <path d="M156.85 31C161.65 31 164.85 32.6 164.85 32.6V39C164.85 39 160.05 37.4 156.85 37.4C152.05 37.4 147.25 40.6 147.25 47C147.25 53.4 152.05 56.6 156.85 56.6C160.05 56.6 164.85 55 164.85 55V61.4C164.85 61.4 161.65 63 156.85 63C147.25 63 140.85 56.6 140.85 47C140.85 37.4 147.25 31 156.85 31Z"/>
          <path d="M126.412 43.8C126.412 35.8 131.212 31 139.212 31V37.4C132.812 37.4 126.412 39 126.412 47V63H120.012V31H126.412V43.8Z"/>
          <path d="M115.213 47V48.6H92.9405C93.6445 53.912 98.0605 56.6 102.412 56.6C108.812 56.6 112.012 53.4 112.012 53.4V59.8C112.012 59.8 108.812 63 102.412 63C92.8125 63 86.4125 56.6 86.4125 47C86.4125 37.4 92.8125 31 100.812 31C108.813 31 115.213 37.4 115.213 47ZM100.812 37.4C96.9085 37.4 94.0285 39.512 93.1325 43.8H108.493C107.597 39.512 104.717 37.4 100.812 37.4Z"/>
          <path d="M73.6 31C78.4 31 81.6 34.2 81.6 39V63H75.2V42.2C75.2 39 73.6 37.4 70.4 37.4C67.2 37.4 65.6 39 65.6 42.2V63H59.2V37.4H49.6V63H43.2V31H65.6V39C65.6 34.2 68.8 31 73.6 31Z"/>
        </svg>
        <h1 class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-serif text-ink leading-[0.95] tracking-tight max-w-4xl">
          The backend for<br>
          <span class="italic">selling things</span><br>
          on the internet
        </h1>
        <p class="mt-4 sm:mt-6 lg:mt-8 text-base sm:text-lg lg:text-xl text-ink-secondary max-w-xl leading-relaxed">
          Connect your Stripe account. Deploy to Cloudflare. 
          Start accepting payments in minutes, not months.
        </p>
        <div class="flex gap-3 mt-6 sm:mt-8">
          <a 
            href="https://github.com/withpluto/merchant" 
            target="_blank"
            class="py-2.5 sm:py-3 px-5 sm:px-6 bg-ink text-white rounded-lg text-center text-sm font-medium hover:bg-ink-secondary transition-colors"
            onmousedown="event.stopPropagation()"
          >
            Get Started →
          </a>
          <a 
            href="/docs/" 
            class="py-2.5 sm:py-3 px-5 sm:px-6 bg-white text-ink ring-1 ring-wheat-400 rounded-lg text-center text-sm font-medium hover:ring-wheat-500 transition-all"
            onmousedown="event.stopPropagation()"
          >
            Read Docs
          </a>
        </div>
      </div>
    </div>

    <!-- Video block 1 -->
    <div class="item item-small item-desktop">
      <div class="item-content rounded-3xl ring-1 ring-wheat-400 shadow-sm overflow-hidden">
        <video id="video-1" class="w-full h-full object-cover" autoplay muted loop playsinline></video>
      </div>
    </div>

    <!-- Code REQUEST block -->
    <div class="item item-small item-tablet">
      <div id="request-card" class="item-content bg-[#0a0a0a] rounded-3xl ring-1 ring-white/5 shadow-sm flex flex-col p-4 lg:p-5 overflow-hidden">
        <pre id="request-code" class="font-mono text-[10px] lg:text-xs leading-relaxed overflow-hidden my-auto"></pre>
        <button 
          id="run-btn"
          onclick="runDemo(event)"
          onmousedown="event.stopPropagation()"
          class="mt-3 w-full py-2 bg-[#f5c747]/10 hover:bg-[#f5c747]/20 border border-[#f5c747]/30 text-[#f5c747] text-[10px] lg:text-xs font-mono rounded transition-all hover:border-[#f5c747]/50"
        >
          run →
        </button>
      </div>
    </div>

    <!-- Video block 4 -->
    <div class="item item-small item-tablet">
      <div class="item-content rounded-3xl ring-1 ring-wheat-400 shadow-sm overflow-hidden">
        <video id="video-4" class="w-full h-full object-cover" autoplay muted loop playsinline></video>
      </div>
    </div>

    <!-- Code RESPONSE block -->
    <div class="item item-small item-desktop">
      <div id="response-card" class="item-content bg-[#0a0a0a] rounded-3xl ring-1 ring-white/5 shadow-sm flex flex-col p-4 lg:p-5 overflow-hidden transition-all">
        <div class="flex items-center gap-2 mb-3">
          <span class="text-[10px] lg:text-xs text-neutral-500 font-mono">response</span>
          <span id="status-badge" class="px-1.5 py-0.5 text-[9px] lg:text-[10px] font-mono rounded bg-neutral-800 text-neutral-500">waiting</span>
        </div>
        <pre id="response-code" class="font-mono text-[10px] lg:text-xs leading-relaxed overflow-hidden my-auto text-neutral-600"><code>{
  <span class="text-neutral-700">"..."</span>
}</code></pre>
      </div>
    </div>

    <!-- Video block 2 -->
    <div class="item item-small item-desktop">
      <div class="item-content rounded-3xl ring-1 ring-wheat-400 shadow-sm overflow-hidden">
        <video id="video-2" class="w-full h-full object-cover" autoplay muted loop playsinline></video>
      </div>
    </div>

    <!-- Video block 3 -->
    <div class="item item-small item-desktop">
      <div class="item-content rounded-3xl ring-1 ring-wheat-400 shadow-sm overflow-hidden">
        <video id="video-3" class="w-full h-full object-cover" autoplay muted loop playsinline></video>
      </div>
    </div>

  </div>

  <script>
    // Video files
    const videos = [
      'outfit-1.mp4', 'outfit-2.mp4', 'outfit-3.mp4', 'outfit-4.mp4', 'outfit-5.mp4',
      'furniture-1.mp4', 'product-1.mp4'
    ];
    
    // Randomly assign 3 videos on page load
    function shuffleArray(arr) {
      const shuffled = [...arr];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }
    
    function initVideos() {
      const randomVideos = shuffleArray(videos).slice(0, 4);
      document.getElementById('video-1').src = randomVideos[0];
      document.getElementById('video-2').src = randomVideos[1];
      document.getElementById('video-3').src = randomVideos[2];
      document.getElementById('video-4').src = randomVideos[3];
    }
    
    initVideos();
    
    // Product data for demos
    const products = [
      { name: "Cotton T-Shirt", sku: "TEE-BLK-M", color: "Black", size: "M", price: 2999 },
      { name: "Denim Jacket", sku: "JKT-BLU-L", color: "Blue", size: "L", price: 8999 },
      { name: "Running Sneakers", sku: "SNK-WHT-10", color: "White", size: "10", price: 12999 },
      { name: "Wool Sweater", sku: "SWT-GRY-S", color: "Grey", size: "S", price: 6499 },
      { name: "Canvas Backpack", sku: "BAG-TAN-OS", color: "Tan", size: "OS", price: 7999 },
    ];
    
    function pickProduct() {
      return products[Math.floor(Math.random() * products.length)];
    }
    
    function pickQty() {
      return Math.floor(Math.random() * 3) + 1;
    }
    
    // API demos - product purchase focused
    const apiDemos = [
      {
        name: 'create-variant',
        curl: (p) => `<span class="text-neutral-500">$</span> <span class="text-neutral-300">curl -X POST /v1/products/:id/variants</span> <span class="text-neutral-600">\\</span>
  <span class="text-neutral-500">-H</span> <span class="text-[#a5d6ff]">"Authorization: Bearer sk_..."</span> <span class="text-neutral-600">\\</span>
  <span class="text-neutral-500">-d</span> <span class="text-[#a5d6ff]">'{"sku":"${p.sku}","title":"${p.color} / ${p.size}","price_cents":${p.price}}'</span>`,
        status: '201',
        response: (id, p) => `{
  <span class="text-[#7ee787]">"id"</span>: <span class="text-[#a5d6ff]">"var_${id}"</span>,
  <span class="text-[#7ee787]">"sku"</span>: <span class="text-[#a5d6ff]">"${p.sku}"</span>,
  <span class="text-[#7ee787]">"title"</span>: <span class="text-[#a5d6ff]">"${p.color} / ${p.size}"</span>,
  <span class="text-[#7ee787]">"price_cents"</span>: <span class="text-[#79c0ff]">${p.price}</span>
}`
      },
      {
        name: 'add-to-cart',
        curl: (p, qty) => `<span class="text-neutral-500">$</span> <span class="text-neutral-300">curl -X POST /v1/carts/:id/items</span> <span class="text-neutral-600">\\</span>
  <span class="text-neutral-500">-H</span> <span class="text-[#a5d6ff]">"Authorization: Bearer pk_..."</span> <span class="text-neutral-600">\\</span>
  <span class="text-neutral-500">-d</span> <span class="text-[#a5d6ff]">'{"items":[{"sku":"${p.sku}","qty":${qty}}]}'</span>`,
        status: '200',
        response: (id, p, qty) => `{
  <span class="text-[#7ee787]">"id"</span>: <span class="text-[#a5d6ff]">"cart_${id}"</span>,
  <span class="text-[#7ee787]">"items"</span>: [{
    <span class="text-[#7ee787]">"sku"</span>: <span class="text-[#a5d6ff]">"${p.sku}"</span>,
    <span class="text-[#7ee787]">"title"</span>: <span class="text-[#a5d6ff]">"${p.color} / ${p.size}"</span>,
    <span class="text-[#7ee787]">"qty"</span>: <span class="text-[#79c0ff]">${qty}</span>,
    <span class="text-[#7ee787]">"unit_price_cents"</span>: <span class="text-[#79c0ff]">${p.price}</span>
  }]
}`
      },
      {
        name: 'checkout',
        curl: () => `<span class="text-neutral-500">$</span> <span class="text-neutral-300">curl -X POST /v1/carts/:id/checkout</span> <span class="text-neutral-600">\\</span>
  <span class="text-neutral-500">-H</span> <span class="text-[#a5d6ff]">"Authorization: Bearer pk_..."</span> <span class="text-neutral-600">\\</span>
  <span class="text-neutral-500">-d</span> <span class="text-[#a5d6ff]">'{"success_url":"https://shop.co/thanks"}'</span>`,
        status: '200',
        response: (id) => `{
  <span class="text-[#7ee787]">"checkout_url"</span>: <span class="text-[#a5d6ff]">"https://checkout.stripe.com/c/${id}"</span>,
  <span class="text-[#7ee787]">"session_id"</span>: <span class="text-[#a5d6ff]">"cs_${id}"</span>
}`
      },
      {
        name: 'get-order',
        curl: (p, qty, orderId) => `<span class="text-neutral-500">$</span> <span class="text-neutral-300">curl /v1/orders/ord_${orderId}</span> <span class="text-neutral-600">\\</span>
  <span class="text-neutral-500">-H</span> <span class="text-[#a5d6ff]">"Authorization: Bearer sk_..."</span>`,
        status: '200',
        response: (id, p, qty) => `{
  <span class="text-[#7ee787]">"id"</span>: <span class="text-[#a5d6ff]">"ord_${id}"</span>,
  <span class="text-[#7ee787]">"status"</span>: <span class="text-[#a5d6ff]">"paid"</span>,
  <span class="text-[#7ee787]">"items"</span>: [{<span class="text-[#7ee787]">"sku"</span>:<span class="text-[#a5d6ff]">"${p.sku}"</span>,<span class="text-[#7ee787]">"qty"</span>:<span class="text-[#79c0ff]">${qty}</span>}],
  <span class="text-[#7ee787]">"total_cents"</span>: <span class="text-[#79c0ff]">${p.price * qty}</span>
}`
      },
      {
        name: 'create-product',
        curl: (p) => `<span class="text-neutral-500">$</span> <span class="text-neutral-300">curl -X POST /v1/products</span> <span class="text-neutral-600">\\</span>
  <span class="text-neutral-500">-H</span> <span class="text-[#a5d6ff]">"Authorization: Bearer sk_..."</span> <span class="text-neutral-600">\\</span>
  <span class="text-neutral-500">-d</span> <span class="text-[#a5d6ff]">'{"title":"${p.name}"}'</span>`,
        status: '201',
        response: (id, p) => `{
  <span class="text-[#7ee787]">"id"</span>: <span class="text-[#a5d6ff]">"prod_${id}"</span>,
  <span class="text-[#7ee787]">"title"</span>: <span class="text-[#a5d6ff]">"${p.name}"</span>,
  <span class="text-[#7ee787]">"status"</span>: <span class="text-[#a5d6ff]">"active"</span>,
  <span class="text-[#7ee787]">"variants"</span>: <span class="text-neutral-500">[]</span>
}`
      },
    ];
    
    let currentDemo = null;
    let isRunning = false;
    
    function genId() {
      return Math.random().toString(36).substr(2, 8);
    }
    
    function pickRandomDemo(exclude = null) {
      const available = exclude ? apiDemos.filter(d => d !== exclude) : apiDemos;
      return available[Math.floor(Math.random() * available.length)];
    }
    
    function showDemo(demo) {
      const requestCode = document.getElementById('request-code');
      const responseCode = document.getElementById('response-code');
      const badge = document.getElementById('status-badge');
      
      const p = pickProduct();
      const qty = pickQty();
      const id = genId();
      
      requestCode.innerHTML = `<code>${demo.curl(p, qty, id)}</code>`;
      badge.textContent = demo.status;
      badge.className = 'px-1.5 py-0.5 text-[9px] lg:text-[10px] font-mono rounded bg-[#f5c747]/20 text-[#f5c747]';
      responseCode.innerHTML = `<code>${demo.response(id, p, qty)}</code>`;
      currentDemo = demo;
    }
    
    // Initialize with random demo
    showDemo(pickRandomDemo());
    
    function runDemo(e) {
      e.stopPropagation();
      if (isRunning) return;
      isRunning = true;
      
      const btn = document.getElementById('run-btn');
      const badge = document.getElementById('status-badge');
      const responseCode = document.getElementById('response-code');
      const responseCard = document.getElementById('response-card');
      const requestCard = document.getElementById('request-card');
      const requestCodeEl = document.getElementById('request-code');
      
      // Pick new demo and product
      const newDemo = pickRandomDemo(currentDemo);
      const p = pickProduct();
      const qty = pickQty();
      const id = genId();
      
      // Update request
      requestCodeEl.innerHTML = `<code>${newDemo.curl(p, qty, id)}</code>`;
      requestCard.classList.add('ring-[#f5c747]/30');
      
      // Running state
      btn.innerHTML = '<span class="animate-pulse">running...</span>';
      btn.disabled = true;
      badge.textContent = 'loading';
      badge.className = 'px-1.5 py-0.5 text-[9px] lg:text-[10px] font-mono rounded bg-[#f5c747]/10 text-[#f5c747]/70 animate-pulse';
      responseCode.innerHTML = `<code class="text-neutral-600 animate-pulse">awaiting response...</code>`;
      
      // Simulate response
      setTimeout(() => {
        requestCard.classList.remove('ring-[#f5c747]/30');
        badge.textContent = newDemo.status;
        badge.className = 'px-1.5 py-0.5 text-[9px] lg:text-[10px] font-mono rounded bg-[#f5c747]/20 text-[#f5c747]';
        responseCard.classList.add('ring-[#f5c747]/30');
        setTimeout(() => responseCard.classList.remove('ring-[#f5c747]/30'), 1500);
        
        responseCode.innerHTML = `<code>${newDemo.response(id, p, qty)}</code>`;
        currentDemo = newDemo;
        
        btn.innerHTML = 'run →';
        btn.disabled = false;
        isRunning = false;
      }, 800);
    }
    
    function getLayout() {
      const w = window.innerWidth;
      if (w >= 1024) return { cols: 4, rows: 3 }; // lg
      if (w >= 768) return { cols: 2, rows: 2 };  // md
      return { cols: 1, rows: 2 };                 // mobile
    }
    
    function updateSizes() {
      const layout = getLayout();
      const padding = window.innerWidth < 640 ? 8 : 12; // matches body p-2 sm:p-3
      
      // Use viewport dimensions minus body padding
      const containerWidth = window.innerWidth - (padding * 2);
      const containerHeight = window.innerHeight - (padding * 2);
      
      // Calculate cell sizes (no gap math needed - padding on items creates the gaps)
      const colWidth = containerWidth / layout.cols;
      const rowHeight = containerHeight / layout.rows;
      
      // Hero sizing
      const hero = document.querySelector('.item-hero');
      if (layout.cols === 4) {
        hero.style.width = (colWidth * 3) + 'px';
        hero.style.height = (rowHeight * 2) + 'px';
      } else if (layout.cols === 2) {
        hero.style.width = (colWidth * 2) + 'px';
        hero.style.height = rowHeight + 'px';
      } else {
        hero.style.width = colWidth + 'px';
        hero.style.height = rowHeight + 'px';
      }
      
      // Small items
      document.querySelectorAll('.item-small').forEach(item => {
        item.style.width = colWidth + 'px';
        item.style.height = rowHeight + 'px';
      });
      
      // Show/hide based on breakpoint
      document.querySelectorAll('.item-desktop').forEach(item => {
        item.style.display = layout.cols >= 4 ? 'block' : 'none';
      });
      document.querySelectorAll('.item-tablet').forEach(item => {
        item.style.display = layout.cols >= 2 ? 'block' : 'none';
      });
    }
    
    // Initialize
    updateSizes();
    
    const grid = new Muuri('#grid', {
      dragEnabled: true,
      dragHandle: '.item-content',
      layout: {
        fillGaps: true,
        rounding: false,
      },
      layoutDuration: 300,
      layoutEasing: 'cubic-bezier(0.25, 1, 0.5, 1)',
      dragStartPredicate: {
        distance: 10,
        delay: 0,
      },
      dragRelease: {
        duration: 300,
        easing: 'cubic-bezier(0.25, 1, 0.5, 1)',
      },
      dragSortHeuristics: {
        sortInterval: 50,
      },
    });
    
    // Shuffle cards on page load (keep hero first so it lays out properly)
    const items = grid.getItems();
    const heroItem = items.find(item => item.getElement().classList.contains('item-hero'));
    const otherItems = items.filter(item => item !== heroItem);
    const shuffledOthers = [...otherItems].sort(() => Math.random() - 0.5);
    const finalOrder = [heroItem, ...shuffledOthers];
    grid.sort(finalOrder, { layout: 'instant' });
    
    // Reveal grid after layout is ready (prevents FOUC)
    requestAnimationFrame(() => {
      document.getElementById('grid').classList.add('ready');
    });
    
    // Relayout on resize
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        updateSizes();
        grid.refreshItems().layout();
      }, 100);
    });
  </script>

</body>
</html>
